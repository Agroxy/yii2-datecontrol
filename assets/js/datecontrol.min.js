/*!
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014
 * @version 1.9.1
 *
 * Date control validation plugin
 * 
 * Author: Kartik Visweswaran
 * Copyright: 2014, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */!function(e){"use strict";var t=function(t,a){return null===t||void 0===t||0===t.length||a&&""===e.trim(t)},a=function(t,a){this.$element=e(t),this.init(a),this.listen()};a.prototype={constructor:a,init:function(a){var n=this,i=t(a.dateSettings)?{}:{dateSettings:a.dateSettings};e.each(a,function(e,t){n[e]=t}),n.$idSave=e("#"+a.idSave),n.dateFormatter=window.DateFormatter?new window.DateFormatter(i):{},n.isChanged=!1,n.oldValue=null},validate:function(){var a=this,n=a.$element,i=a.$idSave,r=a.url,o=a.reqType,s=a.dispFormat,d=a.saveFormat,u=a.dispTimezone,l=a.saveTimezone,c=a.asyncRequest,v=a.dateFormatter;if(!a.isChanged)if(a.isChanged=!0,t(n.val()))i.val(""),a.isChanged=!1;else if(t(r)){var p=v.parseDate(n.val(),s);p===!1&&(p=v.guessDate(n.val(),s),n.val(v.formatDate(p,s))),i.val(v.formatDate(p,d)),a.isChanged=!1}else e.ajax({url:r,type:"post",dataType:"json",async:c,data:{displayDate:n.val(),type:o,dispFormat:s,saveFormat:d,dispTimezone:u,saveTimezone:l},success:function(e){"success"===e.status&&i.val(e.output)},complete:function(){a.isChanged=!1},error:function(){a.isChanged=!1}})},listen:function(){var a=this,n=a.$element,i=a.$idSave,r=a.dispFormat,o=a.dateFormatter;n.on("change",function(){a.validate(),i.trigger("change")}).on("focus",function(){a.oldValue=n.val()}).on("blur",function(){n.val()!==a.oldValue&&(a.validate(),i.trigger("change"))}).on("keydown",function(a){var s,d;if(!t(n.val())&&!t(o)){if(38===a.keyCode||40===a.keyCode){if(s=o.parseDate(n.val(),r),a.preventDefault(),!s)return;return d=s.getDate()+39-+a.keyCode,s.setDate(d),d=o.formatDate(s,r),n.val(d),n.trigger("change"),e.isFunction(n.parent().datepicker)&&n.parent().datepicker("update"),void(e.isFunction(n.datepicker)&&n.datepicker("update"))}i.trigger("keydown")}})}},e.fn.datecontrol=function(t){var n=Array.apply(null,arguments);return n.shift(),this.each(function(){var i=e(this),r=i.data("datecontrol"),o="object"==typeof t&&t;r||(r=new a(this,e.extend({},e.fn.datecontrol.defaults,o,e(this).data())),i.data("datecontrol",r)),"string"==typeof t&&r[t].apply(r,n)})},e.fn.datecontrol.defaults={dateSettings:{longDays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],longMonths:["January","February","March","April","May","June","July","August","September","October","November","December"],meridiem:["AM","PM"]},dispTimezone:null,saveTimezone:null,asyncRequest:!0},e.fn.datecontrol.Constructor=a}(window.jQuery);